# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    telnet.expect                                      :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: hherin <hherin@student.42.fr>              +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2021/04/28 13:04:49 by heleneherin       #+#    #+#              #
#    Updated: 2021/05/10 14:45:56 by hherin           ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

#!/usr/bin/expect -f

set timeout -1

set args [lrange $argv 0 end]

set fd [open "ls_files"]
set filepath [split [read -nonewline $fd] "\n"]
close $fd

log_file expLog.log

foreach path $filepath {
    spawn ../webserv ../parser/test/conf >> webLog.log
    spawn telnet {*}$args
    expect ".\r"
    set fdreq [open "$path"]
    set request [read $fdreq]
    send -- "$request\r"  
    close $fdreq
    sleep 1
}

log_file

expect eof {exit 23}